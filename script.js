// ===== 例文をここに5本入れる =====
const TEXTS = [
  { id: "t1", title: "商法の要点", text: `商法とは、企業に関する法。商売（営業・取引）を円滑かつ公正に行うためのルールを定めた法律です。
  会社だけでなく、個人事業主も含めた「商人」が行う売買や取引の基本ルールであり、一般的な個人間の取引に適用される「民法」よりも優先される「特別法」。
商法は経済活動全般を支える「民法」を補完する役割を持っている。

商法の科目＝会社法、有価証券法、商法総則・商行為の3つ。
会社法では株式会社と持分会社・合名会社、合資会社、合同会社。この4つの会社は社員の責任の態様が違う。

間接有限責任＝株式会社
直接無限責任＝合名会社
無限責任社員と出資額を限度とする有限責任社員＝合資会社
出資者全員が間接有限責任＝合同会社・llc

株主平等の原則は、会社が株主をその持つ株式の内容と数に応じて平等に取り扱うべきという、会社法109条1項に明記された原則。
保有株式数に比例した取扱い: 100株持つ株主は1株の株主の100倍の議決権・配当を受ける権利を持つ
株式会社では「株主有限責任」の原則により、会社は株主に出資の払い戻しをする義務がないため、株主は株式譲渡が唯一の資金回収手段となる。

株式譲渡自由の原則（会社法127条）とは、株主が所有する株式を会社の許可なく第三者へ自由に売却・譲渡できるという株式会社の根本原則です。これは株主の投下資本回収の手段（離脱の自由）を保障し、円滑な資金調達と投資促進を図るためです。

「所有と経営の分離」とは、株式会社において出資者（株主＝所有）と実務を行う取締役（経営者＝経営）を分ける仕組み。株式会社の所有者（株主）が直接の経営をせず、経営を専門の取締役に委任する構造。

株主総会とは、会社法に基づき、経営方針、取締役の選任、配当の決定など、株主が意思決定を行う会合であり、監査役が職務執行にあたる。
公開会社とは、株式譲渡に関する規制を設けていない会社のこと。
非公開会社（株式譲渡制限会社）

株式会社には、会計参与、会計監査人を置く。他には、3委員会（指名委員会、監査委員会、報酬委員会）
資本金とは、会社設立時や増資時に出資者（主に経営者）が払い込んだ、事業運営の元手となる資金（純資産）

配当とは、企業が事業活動で得た利益の一部を、株主に対して現金（配当金）として還元する仕組みです。株式投資における主な収益の1つで、企業への投資家に対するリターンとして支払われます。

手形とは、企業間の取引において、現金に代わり将来の一定期日に代金を支払うことを約束する有価証券です。「信用取引」の一種であり、主に「約束手形」と「為替手形」があります。支払期日に銀行へ持ち込むか、それ以前に銀行へ買い取ってもらう（手形割引）ことで現金化します。

手形の交付欠缺（こうふけんけつ）とは、手形に振出人としての署名・押印はしたものの、それを相手方に渡す（交付する）前に、盗難や紛失などによって手形が意に反して流出してしまった状態のことです。この場合、手形法上の本来的な意思表示がないため、原則として手形上の責任を負いません。

有価証券とは、株式・債券・投資信託など、それ自体が財産的価値を持ち、譲渡することでその権利を移転できる証書（または電子記録）のこと

有価証券法とは、株式、債券、手形などの財産的価値を持つ権利（有価証券）の権利の移転や行使、売買ルールなどを定めた法律の総称。

金融商品取引法（旧・証券取引法）は、株式、社債、投資信託などの「有価証券」の募集・売買、情報開示、市場の公正性、投資家保護に関する総合的な法律です。
2007年の改正により、従来の金融商品に加え、信託受益権やファンド持分など幅広い「二項有価証券」も規制対象となっています。

商人とは「商行為」を継続して行う個人や法人のこと。
商業登記とは、株式会社などの法人について、商号（社名）、所在地、役員、資本金といった重要事項を法務局の登記簿に記載し、一般に公開（公示）する制度。9条

商号とは、会社や個人事業主が営業活動で自らを表示するために使用する「正式な名称」。
商行為法は、商人（商売人・企業）が営業として行う取引（商行為）に適用される（私法・特別法）。
債権とは、債務者に対して、金銭の支払いや物品の引き渡し、サービスの提供など、特定の行為を要求できる権利のことです。お金を貸した人が返済を求める権利（貸金債権）や、商品を売った人が代金を請求する権利（売掛金）などが代表例です。 
債務との関係: 債権は「受け取る権利」、債務は「支払う・行う義務」であり、表裏一体の関係です。

債権の発生原因: 主に契約（売買、貸借）、不法行為、事務管理、不当利得などから発生します。
人に対する権利: 特定の人（債務者）にのみ主張できる権利です。
財産権: 債権もお金に換算できる財産の一つであり、売却や譲渡（債権譲渡）が可能です。

企業法は、会社の設立・運営・組織改編などを規定する会社法を中核とし、商法、金融商品取引法など企業活動に関わる法律の総称。

設権性（設権証券性）とは、手形や小切手などの有価証券において、その証券の作成（振出・発行）という法律行為によって初めて権利や法律関係が発生する性質のこと。

無因証券性とは、手形や小切手において、その発行原因となった取引（売買契約など）が後から無効・取消・解除されても、証券上の権利（支払義務）には影響しないという性質です。証券の取引が安全で迅速に行われるよう、原因関係から切り離された独立した権利として扱われます。
` },
  { id: "t2", title: "民法の要点", text: `「取得時効は権利者の利益を奪う制度であるため、援用を要件として権利帰属の確定を当事者の意思に委ねている。」

民法上の根本原則（1条2項）＝信義則（信義誠実の原則）とは、法律関係において「相手の信頼を裏切らず、誠意を持って行動すべき」という原則です。契約時だけでなく交渉段階や履行全般に適用され、権利の乱用や不誠実な対応を制限して、実質的な公平・衡平を図る機能がある。

債権とは、金銭の支払いや物の引き渡し、あるいはサービスの提供など、特定の行為（給付）を要求できる法的な権利のこと。権利を持つ側を「債権者」、義務を負う側を「債務者」と呼び、契約や不法行為によって発生。 
人に対する権利： 物を直接支配する「物権」とは異なり、債権は特定の相手（債務者）にのみ主張できる権利

債権の発生原因は、「契約」「不法行為」「不当利得」「事務管理」の4つ

意思表示の主観的有効要件とは、法律行為を有効に成立させるために表意者の心内（内心）に求められる要素で、それらを決定する「意思能力」

「意思表示」とは、売買契約の申込みや承諾など、表明する行為です。
「効果意思（意思）」と「表示意思」の不一致がないこと。
意思表示が問題となるケース（無効・取消し） 
内心の真意と表示行為が一致しない場合や、意思表示の過程に欠陥がある場合、以下のような問題が生じます。

心裡留保（93条）: 本人が嘘と知ってする表示で嘘や冗談。原則有効だが、相手方が知っていたら無効。
虚偽表示（通謀虚偽表示・94条）: 相手方と通じてする嘘の表示。無効。

錯誤（95条）: 本人が勘違いをしてした表示。取り消せる。
禁反言（きんはんげん）とは、過去の自己の言動や表示と矛盾する主張・挙動を禁止する信義則上の法理
占有権とは、自分の意思で物を所持・支配している「事実上の状態」に対して民法が認める権利（民法180条）です。真の所有者か否かを問わず、例えば借りた物や盗品であっても、現在支配していれば保護され、占有訴権による物返還請求や妨害排除が可能

身の回りの物を預かっている場合、法律上は「寄託契約（きたくけいやく）」、あるいは「無報酬の寄託」にあたることが多く、預かった人（受寄者）には特定の義務と権利が生じます。（民法659条）

親戚からの預かり物や、友人からの預かり物であっても、不要になったからといって勝手に処分すると、不法行為（民法709条）として損害賠償を請求されるリスクがあります
` },
  { id: "t3", title: "憲法の要点", text: `憲法＝国民の基本的人権を守るために、国家権力（政府や国会など）の働きを制限し、国家の統治の在り方を定めた最高法規。法律とは異なり「国を縛るルール」であり、立憲主義に基づき、国民主権、基本的人権の尊重、平和主義の3つが基本原則

法律＝国会（国民の代表者）の議決を経て定められる、日本国の最高法規である憲法に基づく強制力を持った社会のルールです。社会秩序の維持と、国民の権利・自由・財産を守るために存在。

憲法と法律の違いは「守るべき対象」と「順位」です。憲法は国の最高法規で「国家権力を縛り、人権を守る」もので、法律は国会が制定し「国民の行動を制限し、社会秩序を保つ」もの。法律は憲法に反することができず、改正手続きも法律のほうが容易。

法律の留保（ほうりつのりゅうほ）とは、行政機関が特定の活動（特に国民の権利・自由を制限する行為）を行う際、事前に国会が定めた法律の根拠が必要であるという行政法の原則です。「法律の根拠がなければ行政活動はできない」という「法律による行政の原理」の核心部分。

三段階審査論＝憲法上の権利が侵害されたか否かを判断する司法審査の土台。
1.権利の保護領域（保障範囲）、2.その権利の制約（介入）、3.制約の正当化（違憲審査）という順序で論理的に思考する手法。正確な合憲性判断のための手続きです。
違憲審査（違憲立法審査）＝国会が制定した法律や行政の処分が、最高法規である憲法に違反していないかを裁判所が審査し、違反する場合は無効と判断する制度。日本国憲法81条に基づき最高裁判所が最終的な権限を持つ。
` },
  { id: "t4", title: "行政法の要点", text: `行政法＝国や地方自治体（行政主体）の組織・活動・救済に関する法ルールの総称
行政手続法＝行政機関が許認可の審査、不利益処分、行政指導、届出、命令の制定。
行政法の3本柱と基本構成＝①公益優先性、②公権力性、③目的:＝権力の濫用を防ぎ法律に基づく適正な行政（法治行政）を実現し、国民の権利・利益を守る。

行政立法は、国会（立法府）が作った法律に基づいて、内閣や各省庁などの行政機関が、一般的・抽象的なルール（政令・省令・規則など）を定める行為（委任立法）。憲法が定める「国会の唯一の立法機関」性（41条）の例外として、行われる。

行政立法は、行政機関が定める2つの規範。
法規命令：国民の権利義務を規律する。
行政規則：行政組織内部でのみ効力を持ち、国民に直接の権利義務を生じさせない。通達、告示、訓令などが該当。

公定力とは、行政行為（処分）に違法な瑕疵（かし）があったとしても、重大かつ明白な無効事由がない限り、権限ある機関（行政庁や裁判所）によって取り消されるまでは、一応有効なものとして通用する効力のこと。行政法の重要な原則で、主に公益の保護や行政行為の安定性を確保するために認められる。

訴訟＝「民事」「刑事」「行政」「憲法」の4種類。個人の紛争を扱う民事（損害賠償・離婚等）、犯罪を裁く刑事、国や自治体を相手にする行政、憲法違反を問う憲法訴訟に分類されます。

訴訟要件（裁判所、当事者、訴訟物に関する適法な前提条件）を欠く場合、裁判所は実質的な審理を行わず、「訴え却下判決」を下します。

民事訴訟 (私人間、企業間の紛争)
刑事訴訟 (犯罪の有無と刑罰を確定)
行政訴訟 (行政機関の処分を争う)
抗告訴訟: 処分の取消し、無効確認、不作為の違法確認、義務付け、差止め。
当事者訴訟: 実質的当事者訴訟、形式的当事者訴訟。
憲法訴訟 (法律等が憲法に違反するか)

抗告訴訟＝行政庁の公権力の行使（処分・裁決など）に不服がある場合に、その違法を主張して取消しや無効確認を求める行政訴訟です。行政事件訴訟法に定められ、処分・裁決の取消し、無効等確認、不作為の違法確認、義務付け、差止めの6つの類型。
抗告訴訟の処分性＝定義: 抗告訴訟の対象となる「行政庁の処分その他公権力の行使に当たる行為（行政事件訴訟法3条2項）」かどうかの判断基準

原告適格＝特定の訴訟（主に取消訴訟）において、原告として訴えを提起し、本案判決を受けるために必要な資格。行政事件訴訟法9条1項により、原則として「処分又は裁決の取消しを求めるにつき法律上の利益を有する者」に限られ、この利益は単なる事実上の反射的利益ではなく、法律上保護された利益であることが必要。 

定義: 処分により自己の権利や法律上保護された利益を侵害されるおそれのある者。

訴訟要件（そしょうようけん）とは、民事裁判において、裁判所が請求の当否（本案）を審理・判断するために満たされていなければならない前提条件です。
行政処分（営業停止、許可却下など）への不服申し立ては、「審査請求」の形式で行われ、処分を知った日の翌日から60日以内に上級行政庁等へ申し立てます。

比例原則とは、行政目的の達成において、手段が目的と釣り合い、必要かつ最小限度でなければならないとする行政法の一般原則。過剰な権利・利益の制約を禁じる「雀を撃つのに大砲を使ってはならない」という例えが有名。「警察比例の原則」として警察官職務執行法1条2項にも明記され、目的と手段のバランスを重視。

行政裁量とは、法律が、行政機関が独自の判断余地を与え、一定の活動の自由を認めている場合の事。
①要件裁量: 「〜と認められるとき」など、要件に該当するかどうかの判断。
➁効果裁量: 許可をするか、許可の条件をどうするかなど、結果の選択。

処分性とは、行政事件訴訟において、取消訴訟の対象となる「行政庁の処分その他公権力の行使に当たる行為（行政事件訴訟法3条2項）」に該当するかどうかの基準です。直接国民の権利義務を確定・形成する法的効果を持つ行為に認められ、これがある場合に司法審査が可能となる、行政法上の基本要件。
処分性あり＝① 公権力性：行政庁が優越的な立場から一方的に行う行為であること。
② 直接的な法的効果：その行為によって直接的に国民の権利義務が変動すること。
③ 外部性：内部的な通達や指示ではなく、外部の個人・団体に作用すること。

不利益処分とは、行政機関が法律や条例に基づき、特定の個人や法人に対して一方的に義務を課したり、権利を制限・剥奪したりする行為です。営業停止命令、免許取消、返還命令などが代表例で、行政手続き法により事前の反論機会（聴聞・弁明）の付与が義務付けられています。

行政不服申し立て（審査請求）は、行政の違法・不当な処分に不服がある際に、無料で迅速に再審査を求める手続き。原則として処分を知った日の翌日から3ヶ月以内に、処分庁の上級庁などへ申し立てます
① 審査請求
② 再調査の請求
③ 再審査請求
意思表示の主観的有効要件は、内心的効果意思（真意）、表示意思（外部へ表明する意思）、表示行為（外部へ表明する行為）の3要素で構成されます。

賃借人の反対語は、物件や物を貸す側の「賃貸人（ちんたいにん・貸主・大家さん）」

国家賠償法は、公務員の職務上の不法行為（1条）や公共施設（営造物）の管理瑕疵（2条）により損害を受けた国民が、国や地方公共団体に賠償を求める権利を定めた法律です。明治憲法の「国家無答責」を転換し、日本国憲法17条に基づき1947年に制定され、国民の救済を目的としています。＝

1条（公権力行使）: 公務員が職務で故意・過失により違法に損害を与えた場合、国や公共団体が賠償する。
2条（営造物の瑕疵）: 道路、河川、公園などの管理・設置に欠陥があり損害が生じた場合、国・公共団体が賠償する。
求償権: 公務員に故意または重過失があった場合、国や団体はその公務員に賠償額を求償できる。
不法行為責任: 国家賠償法に定めのない事項は、民法の規定が適用される。

行政救済法は、行政活動で権利を侵害された国民を救済する法体系であり、大きく行政争訟（行政に対する不服・訴訟）と国家補償（金銭的な埋め合わせ）に分かれます。主な種類は、行政不服審査法、行政事件訴訟法、国家賠償法、損失補償の4つです。
行政救済の主な4つの体系 
1 行政不服審査法 (行政権による救済)＝行政機関に対し、違法・不当な処分について
　申し立てる（不服申立て）。
２ 行政事件訴訟法 (司法権による救済)裁判所に訴え、行政処分の取り消しや無効を
   求める。
3　国家賠償法 (金銭的救済・違法)公務員の違法行為で生じた損害の賠償を請求する。
4　損失補償 (金銭的救済・適法)
適法な行政活動（例：土地収用）により特別の損失を被った場合に、その埋め合わせを求める。 
行政事件訴訟法の主な分類 
行政事件訴訟法は、主に以下の4つの訴訟類型を定めています。
抗告訴訟: 行政の処分・裁決の取り消しなどを求める（取消訴訟、無効等確認訴訟、不作為の違法確認訴訟など）。
当事者訴訟: 当事者間の法律関係を確認・形成する（例：税金の還付請求）。
民衆訴訟: 個人の救済ではなく、公的な目的で選挙や投票の効力を争う。
機関訴訟: 国または公共団体の機関相互間の争い。 
救済手法の分類 
「処分」そのものをなくす：行政不服審査法・行政事件訴訟法
金銭的に救済する：国家賠償法・損失補償

訴訟選択とは、行政庁の処分や不作為に対して不服がある場合、抗告訴訟（取消訴訟、無効等確認訴訟、不作為の違法確認訴訟など）や義務付け訴訟など、複数の訴訟類型の中から最適なものを選択して提起すること。また、行政事件訴訟法において、審査請求（行政上の異議申し立て）をせず、いきなり訴訟を起こせる「自由選択主義」を指すこともある。
訴訟要件とは、裁判所が原告の請求の当否（本案）を審理・判断（本案判決）するために、事前に満たしている必要がある手続き的な前提条件のこと。要件を欠く場合、裁判所は「訴え却下（門前払い）」をする。一方、本案とは、訴えが適法な場合に、権利の有無を審査する実体審理の対象そのものを指す。 
1. 訴訟要件（そしょうようけん）
裁判所が本案の審理を行う前に調査すべき、手続き上の適法性を確保する要件。 
具体例: 管轄権があること、当事者能力・当事者適格があること、訴えの利益が存在すること、重複起訴でないことなど。
効果: 具備されていない場合、原則として訴え却下判決（訴訟判決）が下され、内容（請求の理由の有無）は審理されない。
調査: 裁判所が職権で調査する（職権調査事項）。 
2. 本案（ほんあん）
民事訴訟において、訴えの適法性を超えた、中心となる紛争の事柄（請求の内容）そのもの。 
本案審理: 「原告の請求は法的に認められるか（権利があるか）」を審理する段階。
本案判決: 本案を審理した結果、請求を認める「認容判決」または認めない「棄却判決」。 

裁量権の逸脱・濫用は、行政機関が法律で認められた自由な判断（裁量）の範囲を超えたり、その目的を誤ったりして不当な処分を下す違法行為です。行政事件訴訟法30条に基づき、裁判所が処分を取り消す基準となります。主な基準として、重要事実の誤認、目的違反、平等原則違反、比例原則違反などがあり、主に「判断過程審査」という手法で判断されます。

錯誤（さくご）とは、法律上、表意者が「内心の意思」と「表示した内容」が食い違っていることを認識せずに意思表示をする、いわゆる「勘違い」のことです。民法95条により、法律行為の重要な部分に錯誤があり、かつ重過失がない場合は、その意思表示を取り消すことができます。
` },
  { id: "t5", title: "刑法の要点", text: `刑法とは犯罪と刑罰に関する法
（要件）（効果）
刑法は法益保護機能と人権保障機能を持つ＝社会秩序の維持
刑法は、国家権力が刑罰を科すことのできる要件（犯罪成立要件）と効果（具体的な刑罰）を明文化し刑罰権の行使

故意犯＝罪を犯す意志
違法性阻却事由＝「正当行為」「正当防衛」「緊急避難」
責任阻却事由 ＝ 「心神喪失」「14歳以下の未成年」
犯罪＝刑法やその他の特別法によって禁止され、具体的な罰則（刑罰）が定められてる行為客観的構成要件に該当する事実＝実行行為、
犯罪成立要件＝①構成要件該当性、②違法性、③有責性
故意38条　故意が無ければ犯罪にならない　例外は過失犯

拘禁刑＝「懲役刑」と「禁錮刑」を統合した刑事罰（自由刑）
　　無期または1ヶ月以上20年以下の有期（加重により最大30年）
併合罪などで加重される場合は最長30年、減軽は1ヶ月未満。
刑罰は、刑法により死刑、懲役、禁錮、罰金、拘留、科料の6種類（主刑）に加え、没収（付加刑）の合計7種類
付加刑とは、懲役・禁錮・罰金などの「主刑」に付加される刑罰。

誤想防衛とは、実際には正当防衛の要件となる「急迫不正の侵害」が存在しないのに、それを「ある」と誤信して反撃行為を行うことです。
これは法律上、違法性阻却事由の錯誤（事実の錯誤）として扱われ、故意が否定されるため、
基本的に殺人罪や傷害罪などの故意犯は成立しません。
` },
];
// ====================================

const targetDiv = document.getElementById("target");
const input = document.getElementById("input");
const errorSound = document.getElementById("errorSound");
const message = document.getElementById("message");
const textSelect = document.getElementById("textSelect");

// resetBtn は「無い」前提で安全に扱う（あってもOK）
const resetBtn = document.getElementById("resetBtn");

let currentTextIndex = 0;
let targetText = TEXTS[0].text;
let currentIndex = 0;
let isComposing = false;

let flashIndex = -1;
let flashTimer = null;

function escapeHTML(s) {
  return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

function showError(msg) {
  if (!targetDiv) return;
  targetDiv.innerHTML = `<div style="color:red; white-space:pre-wrap;">${escapeHTML(msg)}</div>`;
}

function render() {
  if (!targetDiv) return;

  const before = escapeHTML(targetText.slice(0, currentIndex));
  const curChar = currentIndex < targetText.length ? escapeHTML(targetText[currentIndex]) : "";
  const after = escapeHTML(targetText.slice(currentIndex + 1));

  const shouldFlash = (flashIndex === currentIndex) && currentIndex < targetText.length;

  targetDiv.innerHTML =
    `<span class="correct">${before}</span>` +
    (shouldFlash ? `<span class="flash-error">${curChar || " "}</span>` : `${curChar}`) +
    `${after}`;

  if (message) {
    message.textContent = `${TEXTS[currentTextIndex].title}：${currentIndex} / ${targetText.length}`;
  }
}

function beep() {
  if (!errorSound) return;
  errorSound.currentTime = 0;
  errorSound.play();
}

function flashHere() {
  flashIndex = currentIndex;
  render();

  if (flashTimer) clearTimeout(flashTimer);
  flashTimer = setTimeout(() => {
    flashIndex = -1;
    render();
  }, 600);
}

function validateInput() {
  const value = input.value;
  const expected = targetText.slice(0, value.length);

  if (value === expected) {
    currentIndex = value.length;
    render();

    if (currentIndex === targetText.length && targetText.length > 0) {
      localStorage.setItem(`clear_${TEXTS[currentTextIndex].id}`, "true");
      alert("クリア！");
    }
  } else {
    beep();
    flashHere();
    input.value = targetText.slice(0, currentIndex);
  }
}

function resetCurrent() {
  currentIndex = 0;
  input.value = "";
  flashIndex = -1;
  render();
}

function setTextByIndex(idx) {
  currentTextIndex = idx;
  targetText = TEXTS[currentTextIndex].text;

  localStorage.setItem("selected_text_id", TEXTS[currentTextIndex].id);
  resetCurrent();
}

function initSelect() {
  if (!textSelect) {
    showError("エラー：index.html に id=\"textSelect\" の <select> が見つかりません。");
    return;
  }

  // 選択肢を作る（空なら必ずここで入る）
  textSelect.innerHTML = "";
  TEXTS.forEach((t, i) => {
    const opt = document.createElement("option");
    opt.value = String(i);
    opt.textContent = t.title;
    textSelect.appendChild(opt);
  });

  // 前回選択を復元
  const savedId = localStorage.getItem("selected_text_id");
  const savedIndex = TEXTS.findIndex(t => t.id === savedId);
  const startIndex = savedIndex >= 0 ? savedIndex : 0;

  textSelect.value = String(startIndex);
  setTextByIndex(startIndex);

  textSelect.addEventListener("change", () => {
    const idx = Number(textSelect.value);
    setTextByIndex(Number.isFinite(idx) ? idx : 0);
  });

  // resetBtn がある場合だけイベントを付ける（無くても落ちない）
  if (resetBtn) {
    resetBtn.addEventListener("click", resetCurrent);
  }

  // 初回描画の保険
  requestAnimationFrame(() => render());
}

try {
  if (!targetDiv) throw new Error("id='target' が見つかりません（index.htmlを確認）");
  if (!input) throw new Error("id='input' が見つかりません（index.htmlを確認）");

  initSelect();

  input.addEventListener("compositionstart", () => { isComposing = true; });
  input.addEventListener("compositionend", () => { isComposing = false; validateInput(); });

  input.addEventListener("input", (e) => {
    if (isComposing || e.isComposing) return;
    validateInput();
  });

  render();
} catch (e) {
  showError("スクリプトが停止しました。\n\n" + (e?.message || String(e)));
}


